% Yande Liu's System ID Model
% Model of Vehicle Dynamics and Ardupilot ATT controller using system ID

%% Setup State Space Model
% Lateral Dynamics
% States are: [lateral velocity, roll angle, integral of moment of rate,
% and integrator compensation for attitude]
Alat = [-0.1180 32.033 0 0;
       0 -6.411 1 0;
       0 -20.639 0 1;
       0 -1.235 0 0];
Blat = [0; 
        0.0039974;
        0.016275;
        0.0040072];
Clat = [0.3048 0 0 0];
Dlat = 0;

sys_lat_vel = ss(Alat, Blat, Clat, Dlat);

%% Lateral Transfer Function
% include the time delay generated by CIFER
lat_time_delay = 0.156; % (in seconds)

% U(s) = desired roll, Y(s) = Vehicle Velocity
[NUM, DEN] = ss2tf(Alat, Blat, Clat, Dlat);
sys_lat_tf_vel = tf(NUM, DEN, 'InputDelay', lat_time_delay);


% U(s) = desired roll, Y(s) = Vehicle Attitude
C = [0 1 0 0];
[NUM, DEN] = ss2tf(Alat, Blat, C, Dlat);
sys_lat_tf_roll = tf(NUM, DEN, 'InputDelay', lat_time_delay);

%% Analysis of System






%% Model verification using flight log data